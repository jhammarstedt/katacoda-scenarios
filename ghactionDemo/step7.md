# Handling the data and display it with Github Pages
Now we have an output.json file ready to be displayed. But there are still a couple of issues here. The output file will be overwritten every time and we don't really have a way to display the history and compare the results. One could solve this in multiple ways by simply saving data from the output file in another file, but we will utulize github pages to display some selected statistics in a table. 

## Setting up github pages
Go to settings on Github and press Pages. Press activate and just like that you have a page!

<img src="https://github.com/jhammarstedt/katacoda-scenarios/blob/main/ghactionDemo/images/pages_intro1.PNG?raw=true" />


If nothing is specified the page will display your README.md file. In our case we want it to run the `index.html` file in `docs/`. So change the source from root to docs as shown in the image. Github pages will either by default read a index.md or index.html, which fortunate for you, is already in there. You can press the link and try to run it.

Examining the full flowchart again:
<!--<img src="https://github.com/jhammarstedt/katacoda-scenarios/blob/main/ghactionDemo/images/framework.PNG?raw=true" />-->

<img src="https://github.com/jhammarstedt/katacoda-scenarios/blob/main/ghactionDemo/images/tut_2.PNG?raw=true" />


`touch src/generate_output.py`{{execute}}

We then need to insert the following code into the 'src/generate_output.py' script:


``` 
import json
from bs4 import BeautifulSoup
import os

"""
This file will read the latest output file generated by the workflow and take out relevant statistics.
As this tutorial is more to show of the workflow and how to set up a github action than building websites,
we'll be simply inserting the new data in the index.html file instead of having a js file that would read the json file.
which requires some more integration.
"""

with open("output.json","r") as f: 
    data = json.load(f)

# First we get the new data statistics as a markdown to the index file
commit = data["commit_info"]["id"]
date = data["commit_info"]["time"]
mean = data["benchmarks"][0]["stats"]["mean"]
mini = data["benchmarks"][0]["stats"]["mean"]
maxi = data["benchmarks"][0]["stats"]["max"]
std = data["benchmarks"][0]["stats"]["stddev"]

# The format of the index.html is to place new entires in <tr> = <tablerow> which will be inside a tableBody
new_data = f"""<tr>
                <td>{commit} </td>
                <td>{date}</td>
                <td>{mean}</td>
                <td>{maxi}</td>
                <td>{mini}</td>
                <td>{std}</td>
            </tr>"""

# Using bs4 we can now just insert the new data to the table, maybe not best practice but it works :)
html = open('docs/index.html')
soup = BeautifulSoup(html,'html.parser')
soup.tbody.tr.append(BeautifulSoup( new_data,'html.parser'))
html.close()

new_html = soup.prettify(soup.original_encoding)
with open("docs/index.html",'w') as f:
      f.write(new_html)
      f.close()
```{{copy}}



The 'data/generate_output.py' script formats the json file we get when running pytest. It presents the results in an html file using tables. 

We have to add the benchmarking and formatting scripts to our GitHub action. Open the '.github/workflows/python.yml' file using a text editor and insert the following code below the last line:

```
python data/generate_output.py
```{{copy}}

This code will run the pytest benchmarking tool on the 'benchmarking.py' script and the results will be stored in the 'output.json' file. The 'data/generate_output.py' will then format the results stored in 'output.json' and store it in the 'index.html' file. 